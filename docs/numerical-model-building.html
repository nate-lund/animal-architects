<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 11 Numerical Model Building | Animal Architects</title>
  <meta name="description" content="Section 11 Numerical Model Building | Animal Architects" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 11 Numerical Model Building | Animal Architects" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 11 Numerical Model Building | Animal Architects" />
  
  
  

<meta name="author" content="Nate Lund" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modeling-soil-hillslope-landscape-evolution.html"/>
<link rel="next" href="appendix.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="...">My Awesome Book</a></li>
<li><a href="...">John Smith</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Index</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#technical-resources"><i class="fa fa-check"></i><b>1.1</b> Technical Resources</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#notes-to-self"><i class="fa fa-check"></i><b>1.2</b> Notes to Self</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="about-start-here.html"><a href="about-start-here.html"><i class="fa fa-check"></i><b>2</b> About (start here)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="about-start-here.html"><a href="about-start-here.html#table-of-contents"><i class="fa fa-check"></i><b>2.1</b> Table of Contents</a></li>
</ul></li>
<li class="part"><span><b>I Chapter I</b></span></li>
<li class="chapter" data-level="3" data-path="animal-architects-a-conceptual-model-for-geomorphic-and-pedological-animal-activity.html"><a href="animal-architects-a-conceptual-model-for-geomorphic-and-pedological-animal-activity.html"><i class="fa fa-check"></i><b>3</b> <strong>Animal Architects: A Conceptual Model for Geomorphic and Pedological Animal Activity</strong></a></li>
<li class="chapter" data-level="4" data-path="chapter-i-notes.html"><a href="chapter-i-notes.html"><i class="fa fa-check"></i><b>4</b> Chapter I Notes</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-i-notes.html"><a href="chapter-i-notes.html#outline"><i class="fa fa-check"></i><b>4.1</b> Outline</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-i-notes.html"><a href="chapter-i-notes.html#numerical-models"><i class="fa fa-check"></i><b>4.2</b> Numerical Models</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-i-notes.html"><a href="chapter-i-notes.html#annotated-bibliography"><i class="fa fa-check"></i><b>4.3</b> Annotated Bibliography</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="chapter-i-notes.html"><a href="chapter-i-notes.html#part-2"><i class="fa fa-check"></i><b>4.3.1</b> Part 2</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Chapter II</b></span></li>
<li class="chapter" data-level="5" data-path="chatper-overview.html"><a href="chatper-overview.html"><i class="fa fa-check"></i><b>5</b> Chatper Overview</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chatper-overview.html"><a href="chatper-overview.html#data-management-standards"><i class="fa fa-check"></i><b>5.1</b> Data Management Standards</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="erosion-pins.html"><a href="erosion-pins.html"><i class="fa fa-check"></i><b>6</b> Erosion pins</a></li>
<li class="chapter" data-level="7" data-path="sediment-collectors.html"><a href="sediment-collectors.html"><i class="fa fa-check"></i><b>7</b> Sediment Collectors</a></li>
<li class="chapter" data-level="8" data-path="fallout-radionulcides.html"><a href="fallout-radionulcides.html"><i class="fa fa-check"></i><b>8</b> Fallout Radionulcides</a></li>
<li class="chapter" data-level="9" data-path="laser-scanner.html"><a href="laser-scanner.html"><i class="fa fa-check"></i><b>9</b> Laser Scanner</a>
<ul>
<li class="chapter" data-level="9.1" data-path="laser-scanner.html"><a href="laser-scanner.html#data"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="laser-scanner.html"><a href="laser-scanner.html#notes-to-self-1"><i class="fa fa-check"></i><b>9.2</b> Notes to self</a></li>
<li class="chapter" data-level="9.3" data-path="laser-scanner.html"><a href="laser-scanner.html#collecting-data"><i class="fa fa-check"></i><b>9.3</b> Collecting data</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="mapping.html"><a href="mapping.html"><i class="fa fa-check"></i><b>10</b> Mapping</a></li>
<li class="part"><span><b>III Chapter III</b></span></li>
<li class="chapter" data-level="" data-path="modeling-soil-hillslope-landscape-evolution.html"><a href="modeling-soil-hillslope-landscape-evolution.html"><i class="fa fa-check"></i>Modeling Soil, Hillslope, Landscape Evolution</a>
<ul>
<li class="chapter" data-level="10.1" data-path="modeling-soil-hillslope-landscape-evolution.html"><a href="modeling-soil-hillslope-landscape-evolution.html#brief-outline"><i class="fa fa-check"></i><b>10.1</b> Brief Outline</a></li>
<li class="chapter" data-level="10.2" data-path="modeling-soil-hillslope-landscape-evolution.html"><a href="modeling-soil-hillslope-landscape-evolution.html#important-equations-variables"><i class="fa fa-check"></i><b>10.2</b> Important equations / variables</a></li>
<li class="chapter" data-level="10.3" data-path="modeling-soil-hillslope-landscape-evolution.html"><a href="modeling-soil-hillslope-landscape-evolution.html#resources"><i class="fa fa-check"></i><b>10.3</b> Resources</a></li>
<li class="chapter" data-level="10.4" data-path="modeling-soil-hillslope-landscape-evolution.html"><a href="modeling-soil-hillslope-landscape-evolution.html#notes"><i class="fa fa-check"></i><b>10.4</b> Notes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="numerical-model-building.html"><a href="numerical-model-building.html"><i class="fa fa-check"></i><b>11</b> Numerical Model Building</a>
<ul>
<li class="chapter" data-level="11.1" data-path="numerical-model-building.html"><a href="numerical-model-building.html#soil-transport-via-diffusion-advection"><i class="fa fa-check"></i><b>11.1</b> Soil Transport via Diffusion-Advection</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="numerical-model-building.html"><a href="numerical-model-building.html#model-1-r-diffusion-local-mixing-of-included-and-excluded-components."><i class="fa fa-check"></i><b>11.1.1</b> Model 1: R Diffusion (local mixing) of included and excluded components.</a></li>
<li class="chapter" data-level="11.1.2" data-path="numerical-model-building.html"><a href="numerical-model-building.html#model-2-python-diffusion-local-mixing-of-included-components"><i class="fa fa-check"></i><b>11.1.2</b> Model 2: Python diffusion (local mixing) of included components</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="numerical-model-building.html"><a href="numerical-model-building.html#references"><i class="fa fa-check"></i><b>11.2</b> References</a></li>
<li class="chapter" data-level="11.3" data-path="numerical-model-building.html"><a href="numerical-model-building.html#models-and-code"><i class="fa fa-check"></i><b>11.3</b> Models and Code</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>A</b> Appendix</a></li>
<li class="chapter" data-level="B" data-path="gamma-detectors.html"><a href="gamma-detectors.html"><i class="fa fa-check"></i><b>B</b> Gamma Detectors</a>
<ul>
<li class="chapter" data-level="B.0.1" data-path="gamma-detectors.html"><a href="gamma-detectors.html#detector-specs"><i class="fa fa-check"></i><b>B.0.1</b> Detector specs</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="a-brief-history-of-pedology.html"><a href="a-brief-history-of-pedology.html"><i class="fa fa-check"></i><b>C</b> A Brief History of Pedology</a>
<ul>
<li class="chapter" data-level="C.1" data-path="a-brief-history-of-pedology.html"><a href="a-brief-history-of-pedology.html#introduction"><i class="fa fa-check"></i><b>C.1</b> Introduction</a></li>
<li class="chapter" data-level="C.2" data-path="a-brief-history-of-pedology.html"><a href="a-brief-history-of-pedology.html#history-of-pedology"><i class="fa fa-check"></i><b>C.2</b> History of Pedology</a></li>
<li class="chapter" data-level="C.3" data-path="a-brief-history-of-pedology.html"><a href="a-brief-history-of-pedology.html#references-1"><i class="fa fa-check"></i><b>C.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html"><i class="fa fa-check"></i><b>D</b> Radionuclide Sampling Protocol</a>
<ul>
<li class="chapter" data-level="D.1" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#background"><i class="fa fa-check"></i><b>D.1</b> Background</a>
<ul>
<li class="chapter" data-level="D.1.1" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#reference-site-sampling"><i class="fa fa-check"></i><b>D.1.1</b> Reference site sampling</a></li>
<li class="chapter" data-level="D.1.2" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#erosion-sample-positioning"><i class="fa fa-check"></i><b>D.1.2</b> Erosion sample positioning</a></li>
<li class="chapter" data-level="D.1.3" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#erosion-site-sampling"><i class="fa fa-check"></i><b>D.1.3</b> Erosion site sampling</a></li>
<li class="chapter" data-level="D.1.4" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#sample-characteristics"><i class="fa fa-check"></i><b>D.1.4</b> Sample characteristics</a></li>
<li class="chapter" data-level="D.1.5" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#bioturbation-and-nuclide-distribution"><i class="fa fa-check"></i><b>D.1.5</b> Bioturbation and nuclide distribution</a></li>
<li class="chapter" data-level="D.1.6" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#radioisotope-sampling-protocol-for-jumping-worm-erosion-project"><i class="fa fa-check"></i><b>D.1.6</b> Radioisotope Sampling Protocol for Jumping Worm Erosion Project</a></li>
</ul></li>
<li class="chapter" data-level="D.2" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#protocol"><i class="fa fa-check"></i><b>D.2</b> Protocol</a>
<ul>
<li class="chapter" data-level="D.2.1" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#materials"><i class="fa fa-check"></i><b>D.2.1</b> Materials</a></li>
<li class="chapter" data-level="D.2.2" data-path="radionuclide-sampling-protocol.html"><a href="radionuclide-sampling-protocol.html#protocol-adapted-from-iaea-guidelines"><i class="fa fa-check"></i><b>D.2.2</b> Protocol (adapted from IAEA guidelines)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">
Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Animal Architects</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="numerical-model-building" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Section 11</span> Numerical Model Building<a href="numerical-model-building.html#numerical-model-building" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The purpose of this section is to create a quantitative framework, a model, to explore the relationship between bioturbation, erosion, and particle size distribution and their collective impact on soil profile and landscape development.</p>
<p>To this end, the goal primary goal is to create a simple model, with a limited number of input parameters that can…</p>
<ol style="list-style-type: decimal">
<li>Describe how bioturbation creates texture contrast in soils over time.
<ol style="list-style-type: decimal">
<li>E.g. stoneline development or clay movement.</li>
</ol></li>
<li>Describe how erosion rate and particle-size sensitive erosion rate impact texture contrast development.
<ol style="list-style-type: decimal">
<li>E.g. quantitatively model the dynamic denudation framework of Johnson et al. (2005a and 2005b).</li>
</ol></li>
<li>Describe how bioturbation drives soil texture variability across a landscape, including sediment supplied to streams.</li>
<li>Accommodate changes in erosion and mixing rates at discrete time steps.
<ol style="list-style-type: decimal">
<li>E.g. to simulate the impact of an invasive species or introduction of bioturbators.</li>
</ol></li>
<li>Represent a suite of bioturbators with unique particle size preferences and mixing rates and behaviors.</li>
</ol>
<div id="soil-transport-via-diffusion-advection" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Soil Transport via Diffusion-Advection<a href="numerical-model-building.html#soil-transport-via-diffusion-advection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The model is based on a layer system to approximate biodiffusion at depth. The number of layers (currently only 5), layer thickness, and profile depth are user-input. At each time step, the soil properties for each layer are calculated based on input parameters and the properties of the layer directly above and below. The model currently assumes steady state conditions: that erosion and soil formation are equivalent, regardless of soil depth, and thus that soil thickness remains constant over time. [citation about steady state] says this is okay… The model is currently integrates local and non-local mixing to simulate two soil properties: one that is included in diffused material (e.g. clay) and one that is excluded from diffused material (e.g. coarse fragments).</p>
<div class="float">
<img src="images/clipboard-62785000.png" width="414" alt="Figure 1. Visualization of a single layer, i, and the upper and lower layers." />
<div class="figcaption">Figure 1. Visualization of a single layer, i, and the upper and lower layers.</div>
</div>
<p>The first component is the change in diffusion with depth as a result of decreased in organisms activity as noted by many authors [citation]. Two similar functions are used for this purpose: one for local and one for non-local mixing. Following Johnson et al. (2014), this relationship can be described by:</p>
<p><span class="math display">\[
D(z)=s e^{-z/b}
\]</span></p>
<p>Where D is bulk-soil diffusion (m2/yr), s is the surface diffusion rate (m2/yr), z is depth (m), and b is the e-folding length scale related to organism-dependent bioturbation depth (m) [assumed to be 0.28].</p>
<p><img src="31_chapterIII_notes_files/figure-html/Dz-1.png" width="672" /></p>
<p>When considering the impact of diffusion on a single soil property, a biodiffusion function can be applied with a concentration value to describe the flux (g/yr) through the profile. Diffusion-advection is a relatively substantial simplification of the bioturbation process where periods of sediment inactivity are interuppted by trans location events. However, prior studies show that the application of a diffusion-advection equation is appropraite if simulation time and the number of translocation events are sufficiently large (Mitchel et al. 2022). Flux between two layers can then be described by:</p>
<p><span class="math display">\[
V_{y, down}=D(z_i)(y_{i-1}-y_i)
\]</span></p>
<p>Where V<sub>y</sub> is downward flux across layers (g/yr), i is the current layer, and y is the content of some soil property in the ith layer (g/m2). However, net flux into a layer requires consideration of both upward [i - 1] and downward [i + 1] movement, described by:</p>
<p><span class="math display">\[
V_{y}=D(z_i)(y_{i-1}-y_i) + D(z_i+h_i)(y_{i+1}-y_i)
\]</span></p>
<p>[note: bulk density is implicitly included in the y term, but might not always be]</p>
<p>Where h<sub>i</sub> is the thickness of layer i (m). This is functionally similar to the diffusion-advection equation, <span class="math inline">\(\frac{dy}{dt} = \frac{d}{dz}(D(z)\frac{dy}{dz})\)</span>, but in a more easily R-model-able format. However, because diffusion will be zero at the top and bottom of the soil profile, a small adjustment is made to eliminate diffusion.</p>
<p>This model only considers only local mixing, and does not account for material that is excavated from one layer and deposited on the soil surface. Non-local mixing represents a considerable displacement of material and has considerable impacts on surface material contents (Jarvis et al. 2010; Mastisoff et al. 2011).</p>
<p>Including non-local mixing complicates the model and requires more data on the behavior of bioturbators. In comparing models including and excluding non-local mixing, Jarvis et al. 2010 found models without non-local mixing underestimated surface translocation of particles (using 137Cs as tracer). Notably, the authors did not include erosion estimates in their model, which studies show is an important factor in the redistribution of material by bioturbation [citation]. Further study on the importance of modeling non-local mixing is required.</p>
<p>[note to self: burial versus erosion rate is a well-studied topic and is worth looking into here]</p>
<p>However, a primary interest of our model is the movement of material too large to be mixed by bioturbators, coarse fragments. Coarse fragments are included only in downward local soil movement. They move downwards to infill where material is excavated but are too large to be excavated themselves. Ignoring non-local and upward local mixing, flux of coarse fragments can be simplified to:</p>
<p><span class="math display">\[
V_{S, net}=D(z_i)(S_i) + D(z_i+h)(S_{i+1}-S_i)
\]</span></p>
<p>Where S is the concentration of material of a greater size class than movable by present bioturbators. At the top and bottom of the profile, the above diffusion equations are adjusted to be zero.</p>
<p>[input parameter table here]</p>
<div id="model-1-r-diffusion-local-mixing-of-included-and-excluded-components." class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Model 1: R Diffusion (local mixing) of included and excluded components.<a href="numerical-model-building.html#model-1-r-diffusion-local-mixing-of-included-and-excluded-components." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="numerical-model-building.html#cb1-1" tabindex="-1"></a><span class="co">#&#39;###################### [creating a data frame] #######################</span></span>
<span id="cb1-2"><a href="numerical-model-building.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="numerical-model-building.html#cb1-3" tabindex="-1"></a><span class="co">#&#39; [set] number of time steps</span></span>
<span id="cb1-4"><a href="numerical-model-building.html#cb1-4" tabindex="-1"></a>time_steps <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb1-5"><a href="numerical-model-building.html#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="numerical-model-building.html#cb1-6" tabindex="-1"></a><span class="co">#&#39; [set] number of years per time step</span></span>
<span id="cb1-7"><a href="numerical-model-building.html#cb1-7" tabindex="-1"></a>step_years <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb1-8"><a href="numerical-model-building.html#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="numerical-model-building.html#cb1-9" tabindex="-1"></a><span class="co"># build a data frame</span></span>
<span id="cb1-10"><a href="numerical-model-building.html#cb1-10" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">time_step =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(time_steps <span class="sc">-</span> <span class="dv">1</span>)), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb1-11"><a href="numerical-model-building.html#cb1-11" tabindex="-1"></a>                <span class="at">index =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;z&quot;</span>, <span class="st">&quot;bd&quot;</span>, <span class="st">&quot;inc&quot;</span>, <span class="st">&quot;exc&quot;</span>), <span class="at">times =</span> time_steps),</span>
<span id="cb1-12"><a href="numerical-model-building.html#cb1-12" tabindex="-1"></a>                <span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb1-13"><a href="numerical-model-building.html#cb1-13" tabindex="-1"></a>                <span class="st">&quot;B&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb1-14"><a href="numerical-model-building.html#cb1-14" tabindex="-1"></a>                <span class="st">&quot;C&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb1-15"><a href="numerical-model-building.html#cb1-15" tabindex="-1"></a>                <span class="st">&quot;D&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb1-16"><a href="numerical-model-building.html#cb1-16" tabindex="-1"></a>                <span class="st">&quot;E&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb1-17"><a href="numerical-model-building.html#cb1-17" tabindex="-1"></a>                <span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb1-18"><a href="numerical-model-building.html#cb1-18" tabindex="-1"></a>                <span class="st">&quot;bot&quot;</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb1-19"><a href="numerical-model-building.html#cb1-19" tabindex="-1"></a><span class="co">#&#39; [set] layer thickness (m)</span></span>
<span id="cb1-20"><a href="numerical-model-building.html#cb1-20" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb1-21"><a href="numerical-model-building.html#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="numerical-model-building.html#cb1-22" tabindex="-1"></a><span class="co">#split data frame into multiple based on index column. names accordingly</span></span>
<span id="cb1-23"><a href="numerical-model-building.html#cb1-23" tabindex="-1"></a>df2 <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(index) <span class="sc">%&gt;%</span> <span class="fu">group_split</span>(<span class="at">.keep =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;z&quot;</span>, <span class="st">&quot;bd&quot;</span>, <span class="st">&quot;inc&quot;</span>, <span class="st">&quot;exc&quot;</span>))</span>
<span id="cb1-24"><a href="numerical-model-building.html#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="numerical-model-building.html#cb1-25" tabindex="-1"></a><span class="co"># input the top depths of each layer into data frame</span></span>
<span id="cb1-26"><a href="numerical-model-building.html#cb1-26" tabindex="-1"></a>df2[[<span class="st">&quot;z&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="dv">0</span>, h, h<span class="sc">*</span><span class="dv">2</span>, h<span class="sc">*</span><span class="dv">3</span>, h<span class="sc">*</span><span class="dv">4</span>, h<span class="sc">*</span><span class="dv">5</span>, h<span class="sc">*</span><span class="dv">6</span>)</span>
<span id="cb1-27"><a href="numerical-model-building.html#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="numerical-model-building.html#cb1-28" tabindex="-1"></a><span class="co">#&#39; [set] layer bd into data frame, A:F</span></span>
<span id="cb1-29"><a href="numerical-model-building.html#cb1-29" tabindex="-1"></a>df2[[<span class="st">&quot;bd&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb1-30"><a href="numerical-model-building.html#cb1-30" tabindex="-1"></a></span>
<span id="cb1-31"><a href="numerical-model-building.html#cb1-31" tabindex="-1"></a><span class="co">#&#39; [set] starting included and excluded components of each layer, A:F</span></span>
<span id="cb1-32"><a href="numerical-model-building.html#cb1-32" tabindex="-1"></a>df2[[<span class="st">&quot;inc&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="dv">40</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb1-33"><a href="numerical-model-building.html#cb1-33" tabindex="-1"></a>df2[[<span class="st">&quot;exc&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb1-34"><a href="numerical-model-building.html#cb1-34" tabindex="-1"></a></span>
<span id="cb1-35"><a href="numerical-model-building.html#cb1-35" tabindex="-1"></a><span class="co">#&#39;###################### [defining functions] #######################</span></span>
<span id="cb1-36"><a href="numerical-model-building.html#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="numerical-model-building.html#cb1-37" tabindex="-1"></a><span class="co"># define diffusion (bioturbation) function (if statements needed for top and bottom layers) (m/yr)</span></span>
<span id="cb1-38"><a href="numerical-model-building.html#cb1-38" tabindex="-1"></a>Dz <span class="ot">&lt;-</span> <span class="cf">function</span>(z) {</span>
<span id="cb1-39"><a href="numerical-model-building.html#cb1-39" tabindex="-1"></a>  <span class="fl">0.005334</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>z<span class="sc">/</span><span class="fl">0.28</span>) <span class="co"># exponential (Johnson et al., 2014) for eq. (Yeates et a.l, 1995) for intercept</span></span>
<span id="cb1-40"><a href="numerical-model-building.html#cb1-40" tabindex="-1"></a>  <span class="co"># 6.9 * 10^-5 + -1.06 * 10^-4 * z # linear</span></span>
<span id="cb1-41"><a href="numerical-model-building.html#cb1-41" tabindex="-1"></a>}</span>
<span id="cb1-42"><a href="numerical-model-building.html#cb1-42" tabindex="-1"></a></span>
<span id="cb1-43"><a href="numerical-model-building.html#cb1-43" tabindex="-1"></a><span class="co"># diffusion w/ depth function plotting</span></span>
<span id="cb1-44"><a href="numerical-model-building.html#cb1-44" tabindex="-1"></a>eq <span class="ot">=</span> <span class="cf">function</span>(z){<span class="fl">0.005334</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>z<span class="sc">/</span><span class="fl">0.28</span>)}</span>
<span id="cb1-45"><a href="numerical-model-building.html#cb1-45" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">z =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)), <span class="fu">aes</span>(<span class="at">x =</span> z)) <span class="sc">+</span></span>
<span id="cb1-46"><a href="numerical-model-building.html#cb1-46" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> eq) <span class="sc">+</span></span>
<span id="cb1-47"><a href="numerical-model-building.html#cb1-47" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">name =</span> <span class="st">&quot;diffusion (m2/yr)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-48"><a href="numerical-model-building.html#cb1-48" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">name =</span> <span class="st">&quot;depth (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-49"><a href="numerical-model-building.html#cb1-49" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="31_chapterIII_notes_files/figure-html/diffusion-1.png" width="672" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="numerical-model-building.html#cb2-1" tabindex="-1"></a><span class="co"># define function that calculates local inc-diffusion (g/m/yr) into/out of ith layer</span></span>
<span id="cb2-2"><a href="numerical-model-building.html#cb2-2" tabindex="-1"></a>inc_diff_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(yh, yi, yj, zi, bdi) {</span>
<span id="cb2-3"><a href="numerical-model-building.html#cb2-3" tabindex="-1"></a>  <span class="cf">if</span>(zi <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-4"><a href="numerical-model-building.html#cb2-4" tabindex="-1"></a>    <span class="fu">Dz</span>(<span class="at">z =</span> (zi <span class="sc">+</span> h)) <span class="sc">*</span> (yj <span class="sc">-</span> yi) <span class="co"># surface</span></span>
<span id="cb2-5"><a href="numerical-model-building.html#cb2-5" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-6"><a href="numerical-model-building.html#cb2-6" tabindex="-1"></a>    <span class="cf">if</span>(zi <span class="sc">==</span> h <span class="sc">*</span> <span class="dv">5</span>) {</span>
<span id="cb2-7"><a href="numerical-model-building.html#cb2-7" tabindex="-1"></a>      <span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">*</span> (yh <span class="sc">-</span> yi) <span class="co"># bottom</span></span>
<span id="cb2-8"><a href="numerical-model-building.html#cb2-8" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-9"><a href="numerical-model-building.html#cb2-9" tabindex="-1"></a>      <span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">*</span> yh <span class="sc">+</span> <span class="fu">Dz</span>(<span class="at">z =</span> (zi <span class="sc">+</span> h)) <span class="sc">*</span> yj <span class="sc">-</span> yi <span class="sc">*</span> (<span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">+</span> <span class="fu">Dz</span>(<span class="at">z =</span> zi <span class="sc">+</span>h)) <span class="co"># middle</span></span>
<span id="cb2-10"><a href="numerical-model-building.html#cb2-10" tabindex="-1"></a>    }</span>
<span id="cb2-11"><a href="numerical-model-building.html#cb2-11" tabindex="-1"></a>  }</span>
<span id="cb2-12"><a href="numerical-model-building.html#cb2-12" tabindex="-1"></a>}</span>
<span id="cb2-13"><a href="numerical-model-building.html#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="numerical-model-building.html#cb2-14" tabindex="-1"></a><span class="co"># define function that calculates local exc-diffusion (g/m/yr) into/out of ith layer</span></span>
<span id="cb2-15"><a href="numerical-model-building.html#cb2-15" tabindex="-1"></a>exc_diff_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(yh, yi, yj, zi, bdi) {</span>
<span id="cb2-16"><a href="numerical-model-building.html#cb2-16" tabindex="-1"></a>  <span class="cf">if</span>(zi <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-17"><a href="numerical-model-building.html#cb2-17" tabindex="-1"></a>    <span class="fu">Dz</span>(<span class="at">z =</span> (zi <span class="sc">+</span> h)) <span class="sc">*</span> (<span class="dv">0</span> <span class="sc">-</span> yi) <span class="co"># surface</span></span>
<span id="cb2-18"><a href="numerical-model-building.html#cb2-18" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-19"><a href="numerical-model-building.html#cb2-19" tabindex="-1"></a>    <span class="cf">if</span>(zi <span class="sc">==</span> h <span class="sc">*</span> <span class="dv">5</span>) {</span>
<span id="cb2-20"><a href="numerical-model-building.html#cb2-20" tabindex="-1"></a>      <span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">*</span> yh <span class="co"># bottom</span></span>
<span id="cb2-21"><a href="numerical-model-building.html#cb2-21" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-22"><a href="numerical-model-building.html#cb2-22" tabindex="-1"></a>      <span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">*</span> yh <span class="sc">-</span> yi <span class="sc">*</span> <span class="fu">Dz</span>(<span class="at">z =</span> zi <span class="sc">+</span>h) <span class="co"># middle</span></span>
<span id="cb2-23"><a href="numerical-model-building.html#cb2-23" tabindex="-1"></a>    }</span>
<span id="cb2-24"><a href="numerical-model-building.html#cb2-24" tabindex="-1"></a>  }</span>
<span id="cb2-25"><a href="numerical-model-building.html#cb2-25" tabindex="-1"></a>}</span>
<span id="cb2-26"><a href="numerical-model-building.html#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="numerical-model-building.html#cb2-27" tabindex="-1"></a><span class="co">#&#39;###################### [model calculations] #######################</span></span>
<span id="cb2-28"><a href="numerical-model-building.html#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="numerical-model-building.html#cb2-29" tabindex="-1"></a><span class="co"># for loop that fills data frame with diffusion-calculated contents</span></span>
<span id="cb2-30"><a href="numerical-model-building.html#cb2-30" tabindex="-1"></a><span class="cf">for</span>(crow <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(time_steps)) {</span>
<span id="cb2-31"><a href="numerical-model-building.html#cb2-31" tabindex="-1"></a>  <span class="cf">for</span>(ccol <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb2-32"><a href="numerical-model-building.html#cb2-32" tabindex="-1"></a>    <span class="co"># apply inc-diffusion function</span></span>
<span id="cb2-33"><a href="numerical-model-building.html#cb2-33" tabindex="-1"></a>    df2[[<span class="st">&quot;inc&quot;</span>]][crow, ccol] <span class="ot">=</span> </span>
<span id="cb2-34"><a href="numerical-model-building.html#cb2-34" tabindex="-1"></a>      df2[[<span class="st">&quot;inc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol] <span class="sc">+</span></span>
<span id="cb2-35"><a href="numerical-model-building.html#cb2-35" tabindex="-1"></a>      step_years <span class="sc">*</span> </span>
<span id="cb2-36"><a href="numerical-model-building.html#cb2-36" tabindex="-1"></a>      <span class="fu">inc_diff_fun</span>(df2[[<span class="st">&quot;inc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">-</span> <span class="dv">1</span>],</span>
<span id="cb2-37"><a href="numerical-model-building.html#cb2-37" tabindex="-1"></a>                   df2[[<span class="st">&quot;inc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol],</span>
<span id="cb2-38"><a href="numerical-model-building.html#cb2-38" tabindex="-1"></a>                   df2[[<span class="st">&quot;inc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="cb2-39"><a href="numerical-model-building.html#cb2-39" tabindex="-1"></a>                   df2[[<span class="st">&quot;z&quot;</span>]][crow, ccol],</span>
<span id="cb2-40"><a href="numerical-model-building.html#cb2-40" tabindex="-1"></a>                   df2[[<span class="st">&quot;bd&quot;</span>]][crow, ccol])</span>
<span id="cb2-41"><a href="numerical-model-building.html#cb2-41" tabindex="-1"></a>    <span class="co"># apply exc-diffusion function</span></span>
<span id="cb2-42"><a href="numerical-model-building.html#cb2-42" tabindex="-1"></a>    df2[[<span class="st">&quot;exc&quot;</span>]][crow, ccol] <span class="ot">=</span> </span>
<span id="cb2-43"><a href="numerical-model-building.html#cb2-43" tabindex="-1"></a>      df2[[<span class="st">&quot;exc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol] <span class="sc">+</span></span>
<span id="cb2-44"><a href="numerical-model-building.html#cb2-44" tabindex="-1"></a>      step_years <span class="sc">*</span> </span>
<span id="cb2-45"><a href="numerical-model-building.html#cb2-45" tabindex="-1"></a>      <span class="fu">exc_diff_fun</span>(df2[[<span class="st">&quot;exc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">-</span> <span class="dv">1</span>],</span>
<span id="cb2-46"><a href="numerical-model-building.html#cb2-46" tabindex="-1"></a>                    df2[[<span class="st">&quot;exc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol],</span>
<span id="cb2-47"><a href="numerical-model-building.html#cb2-47" tabindex="-1"></a>                    df2[[<span class="st">&quot;exc&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="cb2-48"><a href="numerical-model-building.html#cb2-48" tabindex="-1"></a>                    df2[[<span class="st">&quot;z&quot;</span>]][crow, ccol],</span>
<span id="cb2-49"><a href="numerical-model-building.html#cb2-49" tabindex="-1"></a>                    df2[[<span class="st">&quot;bd&quot;</span>]][crow, ccol])</span>
<span id="cb2-50"><a href="numerical-model-building.html#cb2-50" tabindex="-1"></a>  } </span>
<span id="cb2-51"><a href="numerical-model-building.html#cb2-51" tabindex="-1"></a>}</span>
<span id="cb2-52"><a href="numerical-model-building.html#cb2-52" tabindex="-1"></a></span>
<span id="cb2-53"><a href="numerical-model-building.html#cb2-53" tabindex="-1"></a><span class="co">#&#39;###################### [creating a plotting dataframe] #######################</span></span>
<span id="cb2-54"><a href="numerical-model-building.html#cb2-54" tabindex="-1"></a></span>
<span id="cb2-55"><a href="numerical-model-building.html#cb2-55" tabindex="-1"></a><span class="co"># convert df2 dataframes to long format, one data frame for each inc, exc, and z</span></span>
<span id="cb2-56"><a href="numerical-model-building.html#cb2-56" tabindex="-1"></a>df2_inc_long <span class="ot">&lt;-</span> df2[[<span class="st">&quot;inc&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb2-57"><a href="numerical-model-building.html#cb2-57" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-58"><a href="numerical-model-building.html#cb2-58" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bot =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">6</span><span class="sc">*</span>time_steps)), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb2-59"><a href="numerical-model-building.html#cb2-59" tabindex="-1"></a>df2_exc_long <span class="ot">&lt;-</span> df2[[<span class="st">&quot;exc&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb2-60"><a href="numerical-model-building.html#cb2-60" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-61"><a href="numerical-model-building.html#cb2-61" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bot =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">6</span><span class="sc">*</span>time_steps)), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb2-62"><a href="numerical-model-building.html#cb2-62" tabindex="-1"></a>df2_z_long <span class="ot">&lt;-</span> df2[[<span class="st">&quot;z&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb2-63"><a href="numerical-model-building.html#cb2-63" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-64"><a href="numerical-model-building.html#cb2-64" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bot =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">6</span><span class="sc">*</span>time_steps)), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb2-65"><a href="numerical-model-building.html#cb2-65" tabindex="-1"></a></span>
<span id="cb2-66"><a href="numerical-model-building.html#cb2-66" tabindex="-1"></a><span class="co"># combine the long df2&#39;s</span></span>
<span id="cb2-67"><a href="numerical-model-building.html#cb2-67" tabindex="-1"></a>df2_long_join1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df2_inc_long, df2_z_long, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;.inc&quot;</span>, <span class="st">&quot;.z&quot;</span>), <span class="at">by =</span> <span class="st">&quot;bot&quot;</span>)</span>
<span id="cb2-68"><a href="numerical-model-building.html#cb2-68" tabindex="-1"></a>df2_long <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df2_long_join1, df2_exc_long, <span class="at">by =</span> <span class="st">&quot;bot&quot;</span>)</span>
<span id="cb2-69"><a href="numerical-model-building.html#cb2-69" tabindex="-1"></a></span>
<span id="cb2-70"><a href="numerical-model-building.html#cb2-70" tabindex="-1"></a><span class="co"># select for only key time steps</span></span>
<span id="cb2-71"><a href="numerical-model-building.html#cb2-71" tabindex="-1"></a>df2_long_plot <span class="ot">&lt;-</span> df2_long <span class="sc">%&gt;%</span> </span>
<span id="cb2-72"><a href="numerical-model-building.html#cb2-72" tabindex="-1"></a>  <span class="fu">select</span>(time_step.inc, layer.inc, value.inc, value.z, value) <span class="sc">%&gt;%</span> </span>
<span id="cb2-73"><a href="numerical-model-building.html#cb2-73" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">time_step =</span> time_step.inc, <span class="at">layer =</span> layer.inc, <span class="at">value.exc =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb2-74"><a href="numerical-model-building.html#cb2-74" tabindex="-1"></a>  <span class="fu">filter</span>(time_step <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> </span>
<span id="cb2-75"><a href="numerical-model-building.html#cb2-75" tabindex="-1"></a>           time_step <span class="sc">==</span> (time_steps <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">|</span> </span>
<span id="cb2-76"><a href="numerical-model-building.html#cb2-76" tabindex="-1"></a>           time_step <span class="sc">==</span> (time_steps <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">|</span> </span>
<span id="cb2-77"><a href="numerical-model-building.html#cb2-77" tabindex="-1"></a>           time_step <span class="sc">==</span> (time_steps <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">|</span> </span>
<span id="cb2-78"><a href="numerical-model-building.html#cb2-78" tabindex="-1"></a>           time_step <span class="sc">==</span> (time_steps <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">|</span></span>
<span id="cb2-79"><a href="numerical-model-building.html#cb2-79" tabindex="-1"></a>           time_step <span class="sc">==</span> (time_steps <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb2-80"><a href="numerical-model-building.html#cb2-80" tabindex="-1"></a></span>
<span id="cb2-81"><a href="numerical-model-building.html#cb2-81" tabindex="-1"></a><span class="co">#&#39;###################### [plotting] #######################</span></span>
<span id="cb2-82"><a href="numerical-model-building.html#cb2-82" tabindex="-1"></a></span>
<span id="cb2-83"><a href="numerical-model-building.html#cb2-83" tabindex="-1"></a><span class="co">#plot inc</span></span>
<span id="cb2-84"><a href="numerical-model-building.html#cb2-84" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df2_long_plot, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> value.z,</span>
<span id="cb2-85"><a href="numerical-model-building.html#cb2-85" tabindex="-1"></a>                                           <span class="at">x =</span> value.inc, </span>
<span id="cb2-86"><a href="numerical-model-building.html#cb2-86" tabindex="-1"></a>                                           <span class="at">group =</span> time_step)) <span class="sc">+</span> </span>
<span id="cb2-87"><a href="numerical-model-building.html#cb2-87" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">orientation =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-88"><a href="numerical-model-building.html#cb2-88" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">name =</span> <span class="st">&quot;depth (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-89"><a href="numerical-model-building.html#cb2-89" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Included component content (g/m2)&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-90"><a href="numerical-model-building.html#cb2-90" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>time_step)</span></code></pre></div>
<p><img src="31_chapterIII_notes_files/figure-html/diffusion-2.png" width="672" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="numerical-model-building.html#cb3-1" tabindex="-1"></a><span class="co">#plot exc</span></span>
<span id="cb3-2"><a href="numerical-model-building.html#cb3-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df2_long_plot, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> value.z,</span>
<span id="cb3-3"><a href="numerical-model-building.html#cb3-3" tabindex="-1"></a>                                           <span class="at">x =</span> value.exc, </span>
<span id="cb3-4"><a href="numerical-model-building.html#cb3-4" tabindex="-1"></a>                                           <span class="at">group =</span> time_step)) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="numerical-model-building.html#cb3-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">orientation =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="numerical-model-building.html#cb3-6" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">name =</span> <span class="st">&quot;depth (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-7"><a href="numerical-model-building.html#cb3-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Excluded component content (g/m2)&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="numerical-model-building.html#cb3-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>time_step)</span></code></pre></div>
<p><img src="31_chapterIII_notes_files/figure-html/diffusion-3.png" width="672" /></p>
</div>
<div id="model-2-python-diffusion-local-mixing-of-included-components" class="section level3 hasAnchor" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Model 2: Python diffusion (local mixing) of included components<a href="numerical-model-building.html#model-2-python-diffusion-local-mixing-of-included-components" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="numerical-model-building.html#cb4-1" tabindex="-1"></a><span class="co">### WIP</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> References<a href="numerical-model-building.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Darwin, Charles. The Formation of Vegetable Mould through the Action of Worms: With Observations on Their Habits. 1st ed. Cambridge University Press, 1881. <a href="https://doi.org/10.1017/CBO9780511703850" class="uri">https://doi.org/10.1017/CBO9780511703850</a>.</p>
<p>Johnson, Michelle O., Simon M. Mudd, Brad Pillans, Nigel A. Spooner, L. Keith Fifield, Mike J. Kirkby, and Manuel Gloor. “Quantifying the Rate and Depth Dependence of Bioturbation Based on Optically‐stimulated Luminescence (OSL) Dates and Meteoric 10 Be.” Earth Surface Processes and Landforms 39, no. 9 (July 2014): 1188–96. <a href="https://doi.org/10.1002/esp.3520" class="uri">https://doi.org/10.1002/esp.3520</a>.</p>
<p>Yeates, G. W., and H. Van Der Meulen. “Burial of Soil-Surface Artifacts in the Presence of Lumbricid Earthworms.” Biology and Fertility of Soils 19, no. 1 (January 1995): 73–74. <a href="https://doi.org/10.1007/BF00336350" class="uri">https://doi.org/10.1007/BF00336350</a>.</p>
<p>Jarvis, N. J., A. Taylor, M. Larsbo, A. Etana, and K. Rosén. “Modelling the Effects of Bioturbation on the Re-Distribution of 137Cs in an Undisturbed Grassland Soil.” European Journal of Soil Science 61, no. 1 (2010): 24–34. <a href="https://doi.org/10.1111/j.1365-2389.2009.01209.x" class="uri">https://doi.org/10.1111/j.1365-2389.2009.01209.x</a>.</p>
<p>Matisoff, Gerald, Michael E. Ketterer, Klas Rosén, Jerzy W. Mietelski, Lauren F. Vitko, Henning Persson, and Edyta Lokas. “Downward Migration of Chernobyl-Derived Radionuclides in Soils in Poland and Sweden.” Applied Geochemistry 26, no. 1 (January 2011): 105–15. <a href="https://doi.org/10.1016/j.apgeochem.2010.11.007" class="uri">https://doi.org/10.1016/j.apgeochem.2010.11.007</a>.</p>
<p>Meysman, Filip J.R., Volodymyr S. Malyuga, Bernard P. Boudreau, and Jack J. Middelburg. “A Generalized Stochastic Approach to Particle Dispersal in Soils and Sediments.” Geochimica et Cosmochimica Acta 72, no. 14 (July 2008): 3460–78. <a href="https://doi.org/10.1016/j.gca.2008.04.023" class="uri">https://doi.org/10.1016/j.gca.2008.04.023</a>.</p>

</div>
<div id="models-and-code" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Models and Code<a href="numerical-model-building.html#models-and-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>This first code chunk defines the shared structures and variables used by the following code chunks. It has no outputs itself.</em></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="numerical-model-building.html#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="numerical-model-building.html#cb5-2" tabindex="-1"></a><span class="co"># build structures for data inputs. These do not get overwritten.</span></span>
<span id="cb5-3"><a href="numerical-model-building.html#cb5-3" tabindex="-1"></a>dz <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># m</span></span>
<span id="cb5-4"><a href="numerical-model-building.html#cb5-4" tabindex="-1"></a>z <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">3</span>, dz, dtype<span class="op">=</span><span class="bu">float</span>) <span class="co"># create an array of depths</span></span>
<span id="cb5-5"><a href="numerical-model-building.html#cb5-5" tabindex="-1"></a>y <span class="op">=</span> np.zeros(z.shape, dtype<span class="op">=</span><span class="bu">float</span>) <span class="co"># create a blank array for y, copies shape of z</span></span>
<span id="cb5-6"><a href="numerical-model-building.html#cb5-6" tabindex="-1"></a>p <span class="op">=</span> np.zeros(z.shape, dtype<span class="op">=</span><span class="bu">float</span>)<span class="co"># create a blank array for p, copies shape of z</span></span>
<span id="cb5-7"><a href="numerical-model-building.html#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="numerical-model-building.html#cb5-8" tabindex="-1"></a><span class="co"># [set] initial p values</span></span>
<span id="cb5-9"><a href="numerical-model-building.html#cb5-9" tabindex="-1"></a>p <span class="op">+=</span> <span class="dv">1</span> <span class="co"># mass soil / volume soil</span></span>
<span id="cb5-10"><a href="numerical-model-building.html#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="numerical-model-building.html#cb5-11" tabindex="-1"></a><span class="co"># [set] total time</span></span>
<span id="cb5-12"><a href="numerical-model-building.html#cb5-12" tabindex="-1"></a>total_time <span class="op">=</span> <span class="dv">10000</span> <span class="co"># years</span></span>
<span id="cb5-13"><a href="numerical-model-building.html#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="numerical-model-building.html#cb5-14" tabindex="-1"></a><span class="co"># [set] erosion/denudation rate. erosion (-)</span></span>
<span id="cb5-15"><a href="numerical-model-building.html#cb5-15" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">0</span> <span class="co"># m / yr</span></span>
<span id="cb5-16"><a href="numerical-model-building.html#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="numerical-model-building.html#cb5-17" tabindex="-1"></a><span class="co"># Define the exponential diffusion equation</span></span>
<span id="cb5-18"><a href="numerical-model-building.html#cb5-18" tabindex="-1"></a><span class="kw">def</span> D(z, D0, zb):</span>
<span id="cb5-19"><a href="numerical-model-building.html#cb5-19" tabindex="-1"></a>    <span class="cf">return</span> D0 <span class="op">*</span> np.exp(<span class="op">-</span>z<span class="op">/</span>zb) <span class="co"># in m2/yr</span></span>
<span id="cb5-20"><a href="numerical-model-building.html#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="numerical-model-building.html#cb5-21" tabindex="-1"></a><span class="co"># adjust timestep size</span></span>
<span id="cb5-22"><a href="numerical-model-building.html#cb5-22" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> dz<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">3</span>) <span class="co"># sets time step size, based on Courant–Friedrichs–Lewy condition. Currently a general, low value</span></span>
<span id="cb5-23"><a href="numerical-model-building.html#cb5-23" tabindex="-1"></a>time_steps <span class="op">=</span> <span class="bu">int</span>(total_time <span class="op">/</span> dt) <span class="co"># calculates total number of time steps</span></span>
<span id="cb5-24"><a href="numerical-model-building.html#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="numerical-model-building.html#cb5-25" tabindex="-1"></a></span>
<span id="cb5-26"><a href="numerical-model-building.html#cb5-26" tabindex="-1"></a><span class="kw">def</span> OSL_plt_defaults():</span>
<span id="cb5-27"><a href="numerical-model-building.html#cb5-27" tabindex="-1"></a>  plt.ylim(<span class="op">-</span><span class="fl">1.2</span>, <span class="dv">0</span>)</span>
<span id="cb5-28"><a href="numerical-model-building.html#cb5-28" tabindex="-1"></a>  plt.legend()</span>
<span id="cb5-29"><a href="numerical-model-building.html#cb5-29" tabindex="-1"></a>  plt.xlabel(<span class="st">&#39;Age since exposure to surface (yr)&#39;</span>)</span>
<span id="cb5-30"><a href="numerical-model-building.html#cb5-30" tabindex="-1"></a>  plt.ylabel(<span class="st">&#39;Depth (m)&#39;</span>)</span>
<span id="cb5-31"><a href="numerical-model-building.html#cb5-31" tabindex="-1"></a>  plt.show()</span></code></pre></div>
<p><em>This code plots the differing exponential D(z) equations.</em></p>
<p><img src="32_model_review_files/figure-html/diffusion_dc-1.png" width="672" /></p>
<p><em>This code uses the above the equations to simulate an age profile of soil grains created by biodiffusion, local mixing, only.</em></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="numerical-model-building.html#cb6-1" tabindex="-1"></a><span class="co"># define OSL diffusion only function</span></span>
<span id="cb6-2"><a href="numerical-model-building.html#cb6-2" tabindex="-1"></a><span class="kw">def</span> OSL_diffusion(z, y, p, dz, dt, T, D):</span>
<span id="cb6-3"><a href="numerical-model-building.html#cb6-3" tabindex="-1"></a>  y_copy <span class="op">=</span> y.copy()</span>
<span id="cb6-4"><a href="numerical-model-building.html#cb6-4" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(time_steps):</span>
<span id="cb6-5"><a href="numerical-model-building.html#cb6-5" tabindex="-1"></a>    qy <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> D[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">*</span> np.diff(y_copy <span class="op">*</span> p) <span class="op">/</span> dz</span>
<span id="cb6-6"><a href="numerical-model-building.html#cb6-6" tabindex="-1"></a>    diff <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> np.diff(qy) <span class="op">/</span> dz</span>
<span id="cb6-7"><a href="numerical-model-building.html#cb6-7" tabindex="-1"></a>    advec <span class="op">=</span> T <span class="op">*</span> <span class="op">-</span>np.diff(y_copy <span class="op">*</span> p) <span class="op">/</span> dz</span>
<span id="cb6-8"><a href="numerical-model-building.html#cb6-8" tabindex="-1"></a>    dydt <span class="op">=</span> diff <span class="op">+</span> advec[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span> </span>
<span id="cb6-9"><a href="numerical-model-building.html#cb6-9" tabindex="-1"></a>    y_copy[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">+=</span> dydt <span class="op">*</span> dt</span>
<span id="cb6-10"><a href="numerical-model-building.html#cb6-10" tabindex="-1"></a>  <span class="cf">return</span> y_copy</span>
<span id="cb6-11"><a href="numerical-model-building.html#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="numerical-model-building.html#cb6-12" tabindex="-1"></a>Johnson <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, T, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb6-13"><a href="numerical-model-building.html#cb6-13" tabindex="-1"></a>Kirkby <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, T, D(z, <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.50</span>))</span>
<span id="cb6-14"><a href="numerical-model-building.html#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="numerical-model-building.html#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="numerical-model-building.html#cb6-16" tabindex="-1"></a>plt.clf()</span>
<span id="cb6-17"><a href="numerical-model-building.html#cb6-17" tabindex="-1"></a>plt.plot(Johnson, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;Johnson et al. (2014)&quot;</span>)</span>
<span id="cb6-18"><a href="numerical-model-building.html#cb6-18" tabindex="-1"></a>plt.plot(Kirkby, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;Kirkby (1985)&quot;</span>)</span>
<span id="cb6-19"><a href="numerical-model-building.html#cb6-19" tabindex="-1"></a>OSL_plt_defaults()</span></code></pre></div>
<p><img src="32_model_review_files/figure-html/local_biodiffusion1-3.png" width="672" /></p>
<p><em>This code generates a visualization of the impact of erosion on a theoretical tracer profile. 1) tracer profile at steady state, 2) tracer profile moves downwards under deposition, and 3) tracer profile moves upwards under erosion. Soil surface at z = 0.</em></p>
<p><img src="32_model_review_files/figure-html/erosion_visulization-5.png" width="672" /></p>
<p><em>This code adds advection, by erosion and deposition, to the model.</em></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="numerical-model-building.html#cb7-1" tabindex="-1"></a>T1 <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, <span class="dv">0</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb7-2"><a href="numerical-model-building.html#cb7-2" tabindex="-1"></a>T2 <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, <span class="op">-</span><span class="fl">0.00005</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb7-3"><a href="numerical-model-building.html#cb7-3" tabindex="-1"></a>T3 <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, <span class="op">-</span><span class="fl">0.0001</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb7-4"><a href="numerical-model-building.html#cb7-4" tabindex="-1"></a>T4 <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, <span class="fl">0.00005</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb7-5"><a href="numerical-model-building.html#cb7-5" tabindex="-1"></a>T5 <span class="op">=</span> OSL_diffusion(z, y, p, dz, dt, <span class="fl">0.00001</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb7-6"><a href="numerical-model-building.html#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="numerical-model-building.html#cb7-7" tabindex="-1"></a>plt.clf()</span>
<span id="cb7-8"><a href="numerical-model-building.html#cb7-8" tabindex="-1"></a>plt.plot(T1, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = 0&quot;</span>, color <span class="op">=</span> <span class="st">&quot;Black&quot;</span>)</span>
<span id="cb7-9"><a href="numerical-model-building.html#cb7-9" tabindex="-1"></a>plt.plot(T2, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = -0.00005&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb7-10"><a href="numerical-model-building.html#cb7-10" tabindex="-1"></a>plt.plot(T3, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = -0.0001&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb7-11"><a href="numerical-model-building.html#cb7-11" tabindex="-1"></a>plt.plot(T4, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = 0.00005&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb7-12"><a href="numerical-model-building.html#cb7-12" tabindex="-1"></a>plt.plot(T5, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = 0.0001&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb7-13"><a href="numerical-model-building.html#cb7-13" tabindex="-1"></a>OSL_plt_defaults()</span></code></pre></div>
<p><img src="32_model_review_files/figure-html/local_biodiffusion_advection-1.png" width="672" /></p>
<p><em>This code uses the above function to do some “tracer” plotting with different deposition values.</em></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="numerical-model-building.html#cb8-1" tabindex="-1"></a><span class="co"># define OSL diffusion, with a tracer, function</span></span>
<span id="cb8-2"><a href="numerical-model-building.html#cb8-2" tabindex="-1"></a><span class="kw">def</span> local_diffusion(z, y, p, dz, dt, T, D):</span>
<span id="cb8-3"><a href="numerical-model-building.html#cb8-3" tabindex="-1"></a>  y_copy <span class="op">=</span> y.copy()</span>
<span id="cb8-4"><a href="numerical-model-building.html#cb8-4" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(time_steps):</span>
<span id="cb8-5"><a href="numerical-model-building.html#cb8-5" tabindex="-1"></a>    qy <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> D[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">*</span> np.diff(y_copy <span class="op">*</span> p) <span class="op">/</span> dz</span>
<span id="cb8-6"><a href="numerical-model-building.html#cb8-6" tabindex="-1"></a>    diff <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> np.diff(qy) <span class="op">/</span> dz</span>
<span id="cb8-7"><a href="numerical-model-building.html#cb8-7" tabindex="-1"></a>    advec <span class="op">=</span> T <span class="op">*</span> <span class="op">-</span>np.diff(y_copy <span class="op">*</span> p) <span class="op">/</span> dz</span>
<span id="cb8-8"><a href="numerical-model-building.html#cb8-8" tabindex="-1"></a>    dydt <span class="op">=</span> diff <span class="op">+</span> advec[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-9"><a href="numerical-model-building.html#cb8-9" tabindex="-1"></a>    y_copy[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">+=</span> dydt <span class="op">*</span> dt</span>
<span id="cb8-10"><a href="numerical-model-building.html#cb8-10" tabindex="-1"></a>  <span class="cf">return</span> y_copy</span>
<span id="cb8-11"><a href="numerical-model-building.html#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="numerical-model-building.html#cb8-12" tabindex="-1"></a>smart0 <span class="op">=</span> local_diffusion(z, y, p, dz, dt, <span class="dv">0</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb8-13"><a href="numerical-model-building.html#cb8-13" tabindex="-1"></a>smart <span class="op">=</span> local_diffusion(z, y, p, dz, dt, <span class="fl">0.00001</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb8-14"><a href="numerical-model-building.html#cb8-14" tabindex="-1"></a>smart2 <span class="op">=</span> local_diffusion(z, y, p, dz, dt, <span class="fl">0.0001</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb8-15"><a href="numerical-model-building.html#cb8-15" tabindex="-1"></a>smart3 <span class="op">=</span> local_diffusion(z, y, p, dz, dt, <span class="fl">0.001</span>, D(z, <span class="fl">9.81</span> <span class="op">*</span> <span class="dv">10</span><span class="op">**</span>(<span class="op">-</span><span class="dv">5</span>), <span class="fl">0.28</span>))</span>
<span id="cb8-16"><a href="numerical-model-building.html#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="numerical-model-building.html#cb8-17" tabindex="-1"></a>plt.clf()</span>
<span id="cb8-18"><a href="numerical-model-building.html#cb8-18" tabindex="-1"></a>plt.plot(y, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;original&quot;</span>, color <span class="op">=</span> <span class="st">&quot;Black&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb8-19"><a href="numerical-model-building.html#cb8-19" tabindex="-1"></a>plt.plot(smart0, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = 0&quot;</span>, color <span class="op">=</span> <span class="st">&quot;Black&quot;</span>)</span>
<span id="cb8-20"><a href="numerical-model-building.html#cb8-20" tabindex="-1"></a>plt.plot(smart, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = +0.00001&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb8-21"><a href="numerical-model-building.html#cb8-21" tabindex="-1"></a>plt.plot(smart2, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = +0.0001&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb8-22"><a href="numerical-model-building.html#cb8-22" tabindex="-1"></a>plt.plot(smart3, <span class="op">-</span>z, label <span class="op">=</span> <span class="st">&quot;T = +0.001&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb8-23"><a href="numerical-model-building.html#cb8-23" tabindex="-1"></a>OSL_plt_defaults()</span></code></pre></div>
<p><img src="32_model_review_files/figure-html/nonOSL_diffusion-3.png" width="672" /></p>
<p><em>This code does the above equation</em></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="numerical-model-building.html#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="numerical-model-building.html#cb9-2" tabindex="-1"></a><span class="co"># [set] initial y values</span></span>
<span id="cb9-3"><a href="numerical-model-building.html#cb9-3" tabindex="-1"></a>yi <span class="op">=</span> y.copy()</span>
<span id="cb9-4"><a href="numerical-model-building.html#cb9-4" tabindex="-1"></a>yi[z <span class="op">==</span> <span class="dv">0</span>] <span class="op">+=</span> <span class="dv">1</span> <span class="co"># mass or activity y / mass soil</span></span>
<span id="cb9-5"><a href="numerical-model-building.html#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="numerical-model-building.html#cb9-6" tabindex="-1"></a><span class="co"># [set] initial p values</span></span>
<span id="cb9-7"><a href="numerical-model-building.html#cb9-7" tabindex="-1"></a>pi <span class="op">=</span> p.copy()</span>
<span id="cb9-8"><a href="numerical-model-building.html#cb9-8" tabindex="-1"></a>pi <span class="op">+=</span> <span class="dv">1</span> <span class="co"># mass soil / volume soil</span></span>
<span id="cb9-9"><a href="numerical-model-building.html#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="numerical-model-building.html#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="numerical-model-building.html#cb9-11" tabindex="-1"></a><span class="co"># define isotope local diffusion function, constant D</span></span>
<span id="cb9-12"><a href="numerical-model-building.html#cb9-12" tabindex="-1"></a><span class="kw">def</span> local_diffusion(z, yi, p, dz, dt, T, D):</span>
<span id="cb9-13"><a href="numerical-model-building.html#cb9-13" tabindex="-1"></a>  y_copy <span class="op">=</span> y.copy()</span>
<span id="cb9-14"><a href="numerical-model-building.html#cb9-14" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(time_steps):</span>
<span id="cb9-15"><a href="numerical-model-building.html#cb9-15" tabindex="-1"></a>    qy <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> D[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">*</span> np.diff(y_copy <span class="op">*</span> p) <span class="op">/</span> dz</span>
<span id="cb9-16"><a href="numerical-model-building.html#cb9-16" tabindex="-1"></a>    diff <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> np.diff(qy) <span class="op">/</span> dz</span>
<span id="cb9-17"><a href="numerical-model-building.html#cb9-17" tabindex="-1"></a>    advec <span class="op">=</span> T <span class="op">*</span> <span class="op">-</span>np.diff(y_copy <span class="op">*</span> p) <span class="op">/</span> dz</span>
<span id="cb9-18"><a href="numerical-model-building.html#cb9-18" tabindex="-1"></a>    dydt <span class="op">=</span> diff <span class="op">+</span> advec[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-19"><a href="numerical-model-building.html#cb9-19" tabindex="-1"></a>    y_copy[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>] <span class="op">+=</span> dydt <span class="op">*</span> dt</span>
<span id="cb9-20"><a href="numerical-model-building.html#cb9-20" tabindex="-1"></a>  <span class="cf">return</span> y_copy</span></code></pre></div>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="modeling-soil-hillslope-landscape-evolution.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/nate-lund/animal-architects/blob/main/31_chapterIII_notes.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"download": "pdf"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
