<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Model Building | Animal Architects</title>
  <meta name="description" content="Chapter 6 Model Building | Animal Architects" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Model Building | Animal Architects" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Model Building | Animal Architects" />
  
  
  

<meta name="author" content="Nate Lund" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#technical-resources"><i class="fa fa-check"></i><b>1.1</b> Technical Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="table-of-contents.html"><a href="table-of-contents.html"><i class="fa fa-check"></i><b>2</b> Table of Contents</a></li>
<li class="chapter" data-level="3" data-path="hillslope-transects-erosion-pins-etc..html"><a href="hillslope-transects-erosion-pins-etc..html"><i class="fa fa-check"></i><b>3</b> Hillslope Transects: Erosion Pins, etc.</a></li>
<li class="chapter" data-level="4" data-path="imapct-of-vegetation-cover-on-erosion.html"><a href="imapct-of-vegetation-cover-on-erosion.html"><i class="fa fa-check"></i><b>4</b> Imapct of Vegetation Cover on Erosion</a></li>
<li class="chapter" data-level="5" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><i class="fa fa-check"></i><b>5</b> Animals as Agents of Heterogeneity and Homogeneity in Soil and Landscape Development, a Review</a>
<ul>
<li class="chapter" data-level="5.1" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#purpose-and-goals"><i class="fa fa-check"></i><b>5.1</b> Purpose and Goals</a></li>
<li class="chapter" data-level="5.2" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#goal-1-bioturbation-modeling-landscape"><i class="fa fa-check"></i><b>5.2</b> Goal 1: Bioturbation Modeling Landscape</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#model-types"><i class="fa fa-check"></i><b>5.2.1</b> Model types</a></li>
<li class="chapter" data-level="5.2.2" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#models"><i class="fa fa-check"></i><b>5.2.2</b> Models</a></li>
<li class="chapter" data-level="5.2.3" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#references"><i class="fa fa-check"></i><b>5.2.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#goal-2-bioturbation-across-organisms"><i class="fa fa-check"></i><b>5.3</b> Goal 2: Bioturbation Across Organisms</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html"><a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#references-1"><i class="fa fa-check"></i><b>5.3.1</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-building.html"><a href="model-building.html"><i class="fa fa-check"></i><b>6</b> Model Building</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-building.html"><a href="model-building.html#purpose-and-goals-1"><i class="fa fa-check"></i><b>6.1</b> Purpose and Goals</a></li>
<li class="chapter" data-level="6.2" data-path="model-building.html"><a href="model-building.html#soil-mixing-via-diffusion"><i class="fa fa-check"></i><b>6.2</b> Soil Mixing via Diffusion</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="model-building.html"><a href="model-building.html#code-follows"><i class="fa fa-check"></i><b>6.2.1</b> Code follows</a></li>
<li class="chapter" data-level="6.2.2" data-path="model-building.html"><a href="model-building.html#erosion-and-soil-formation"><i class="fa fa-check"></i><b>6.2.2</b> Erosion and Soil Formation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="model-building.html"><a href="model-building.html#references-2"><i class="fa fa-check"></i><b>6.3</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Animal Architects</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-building" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Model Building<a href="model-building.html#model-building" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<pre><code>## [1] &quot;Updated 10:47, 04 December, 2024&quot;</code></pre>
<div id="purpose-and-goals-1" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Purpose and Goals<a href="model-building.html#purpose-and-goals-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In a general sense, the purpose of this chapter is to create a quantitative framework, a model, to explore the relationship between bioturbation, erosion, and particle size distribution and their collective impact on soil profile and landscape development, across organisms.</p>
<p>To this end, the goal primary goal is to construct a model that integrates bioturbation, erosion, and particle size distribution on soil-profile and landscape scales. More specifically, to create a simple model, with a limited number of input parameters that can…</p>
<ol style="list-style-type: decimal">
<li>Describe how bioturbation creates texture contrast in soils over time.
<ol style="list-style-type: decimal">
<li>E.g. stoneline development or clay homogenization.</li>
</ol></li>
<li>Describe how erosion rate and particle-size sensitive erosion rate impact texture contrast development.
<ol style="list-style-type: decimal">
<li>E.g. quantitatively model the dynamic denudation framework of Johnson et al. (2005a and 2005b).</li>
</ol></li>
<li>Describe how bioturbation drives soil texture variability across a landscape, including sediment supplied to streams.</li>
<li>Accommodate changes in erosion and mixing rates at discrete time steps.
<ol style="list-style-type: decimal">
<li>E.g. to simulate the impact of an invasive species or introduction of bioturbators.</li>
</ol></li>
<li>Represent a suite of bioturbators with unique particle size preferences and mixing rates and behaviors (see Chapter <a href="#review-animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development"><strong>??</strong></a>).</li>
</ol>
</div>
<div id="soil-mixing-via-diffusion" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Soil Mixing via Diffusion<a href="model-building.html#soil-mixing-via-diffusion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The model is based on a layer system to approximate diffusion at depth. At each time step, the soil properties for each layer are calculated based on input parameters and the properties of the layer directly above and below. The model [currently] assumes steady state conditions: that erosion and soil formation are equivalent, regardless of soil depth. [Citation] says this is okay…</p>
<div class="float">
<img src="images/clipboard-62785000.png" width="414" alt="Figure 1. Visualization of a single layer, i, and the upper and lower layers [this figure is a png now, build in r later if I want to keep]" />
<div class="figcaption">Figure 1. Visualization of a single layer, i, and the upper and lower layers [this figure is a png now, build in r later if I want to keep]</div>
</div>
<p>The first component is the change in diffusion with depth, a result of the decrease in bioturbation rate with depth noted by… (citations). Following Johnson et al. (2014), diffusion of bulk soil can be described by:</p>
<p><span class="math display">\[
D(z)=s e^{-z/b}
\]</span></p>
<p>Where D is bulk-soil diffusion (m2/yr), <em>s</em> is the surface diffusion rate (m2/yr) [think burial rate], <em>z</em> is depth (m), and <em>b</em> is a scaling factor related to organism-dependent bioturbation depth (m), assumed to be 0.28.</p>
<p>When considering the impact of diffusion on a single soil property [e.g. clay or coarse fragment content], a diffusion function can be applied with a concentration value to describe the flux (g/yr) through the profile. A diffusion function using these assumptions is approximately accurate for sufficiently long timescales (Mitchel et al. 2022) (see Chapter <a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html#model-types">5.2.1</a> for more details). This is based on the assumptions that spatially, mixing/burrow locations are randomly distributed, and all burrows are infilled with material from the layer directly above, thus upward and downward diffusion are equal. Flux between two layers can then be described by:</p>
<p><span class="math display">\[
V_{y, down}=D(z_i)(y_{i-1}-y_i)
\]</span></p>
<p>Where <em>V<sub>y</sub></em> is downward flux across layers (g/yr), <em>i</em> is the current layer, and <em>y</em> is the content of some soil property in the <em>i</em>th layer (g/m2). However, net flux into a layer requires consideration of both upward [i - 1] and downward [i + 1] movement, described by:</p>
<p><span class="math display">\[
V_{y, net}=D(z_i)(y_{i-a}-y_i) + D(z_i+h)(y_{i+1}-y_i)
\]</span></p>
<p>which is functionally similar to the diffusion equation:</p>
<p><span class="math display">\[
\frac{dy}{dt} = \frac{d}{dz}(D(z)\frac{dy}{dz})
\]</span></p>
<p>[note: bulk density should be included here as well, as a factor multiplied by the y term. it is left out for now for the sake of simplicity, and for the fact that the # of layers in the model is undecided, and having data on both bulk density and bioturbation rate is somewhat rare]</p>
<p>Where h<sub>i</sub> is layer thickness (m). If the soil property, <em>y</em>, is included in the bulk soil being diffused, over time, diffusion will homogenize layers, as <em>y</em> ‘flows’ from layers of high to low concentration. This model only considers local mixing, and does not account for material that is excavated from one layer and deposited on the surface. Jarvis et al. (2010) and Mastisoff et al. (2011) suggest an additional factor in the diffusion-advection equation to account for non-local mixing. Local plus non-local mixing is described by:</p>
<p><span class="math display">\[
placeholder.equation
\]</span></p>
<p>Where… Including non-local mixing complicates the model and requires more data on the behavior of bioturbators. In comparing models including and excluding non-local mixing, Jarvis et al. 2010 found models without non-local mixing underestimated surface translocation of particles (using 137Cs as tracer). Notably, the authors did not include erosion estimates in their model, which studies show is an important factor in the redistribution of material by bioturbation (Mudd and Yoo, 2010) [review this citation again]. Further study on the importance of modeling non-local mixing is required.</p>
<p>[note to self: burial versus erosion rate is a well-studied topic and is worth looking into here]</p>
<p>However, a primary interest of our model is the movement of material too large to be mixed by bioturbators, coarse fragments. Coarse fragments are included only in downward local soil movement. They move downwards to infill where material is excavated but are too large to be excavated themselves. Ignoring non-local and upward local mixing, flux of coarse fragments can be described by:</p>
<p><span class="math display">\[
V_{S, net}=D(z_i)(S_i) + D(z_i+h)(S_{i+1}-S_i)
\]</span></p>
<p>Where S is the concentration of material of a greater size class than movable by present bioturbators.</p>
<div id="code-follows" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Code follows<a href="model-building.html#code-follows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="model-building.html#cb3-1" tabindex="-1"></a><span class="co">#&#39;[run below]</span></span>
<span id="cb3-2"><a href="model-building.html#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="model-building.html#cb3-3" tabindex="-1"></a><span class="co">#&#39;###################### [creating a data frame below] #######################</span></span>
<span id="cb3-4"><a href="model-building.html#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="model-building.html#cb3-5" tabindex="-1"></a><span class="co"># number of time steps</span></span>
<span id="cb3-6"><a href="model-building.html#cb3-6" tabindex="-1"></a>rep_times <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb3-7"><a href="model-building.html#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="model-building.html#cb3-8" tabindex="-1"></a><span class="co"># number of years per time step</span></span>
<span id="cb3-9"><a href="model-building.html#cb3-9" tabindex="-1"></a>rep_years <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb3-10"><a href="model-building.html#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="model-building.html#cb3-11" tabindex="-1"></a><span class="co"># build a data frame</span></span>
<span id="cb3-12"><a href="model-building.html#cb3-12" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">time_step =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(rep_times <span class="sc">-</span> <span class="dv">1</span>)), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb3-13"><a href="model-building.html#cb3-13" tabindex="-1"></a>                <span class="at">index =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;z&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;clay&quot;</span>, <span class="st">&quot;stones&quot;</span>), <span class="at">times =</span> rep_times),</span>
<span id="cb3-14"><a href="model-building.html#cb3-14" tabindex="-1"></a>                <span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb3-15"><a href="model-building.html#cb3-15" tabindex="-1"></a>                <span class="st">&quot;B&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb3-16"><a href="model-building.html#cb3-16" tabindex="-1"></a>                <span class="st">&quot;C&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb3-17"><a href="model-building.html#cb3-17" tabindex="-1"></a>                <span class="st">&quot;D&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb3-18"><a href="model-building.html#cb3-18" tabindex="-1"></a>                <span class="st">&quot;E&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb3-19"><a href="model-building.html#cb3-19" tabindex="-1"></a>                <span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb3-20"><a href="model-building.html#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="model-building.html#cb3-21" tabindex="-1"></a><span class="co">#split data frame into multiple based on index column. names accordingly</span></span>
<span id="cb3-22"><a href="model-building.html#cb3-22" tabindex="-1"></a>df2 <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(index) <span class="sc">%&gt;%</span> <span class="fu">group_split</span>(<span class="at">.keep =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;z&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;clay&quot;</span>, <span class="st">&quot;stones&quot;</span>))</span>
<span id="cb3-23"><a href="model-building.html#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="model-building.html#cb3-24" tabindex="-1"></a><span class="co">#assign the top depths of each layer</span></span>
<span id="cb3-25"><a href="model-building.html#cb3-25" tabindex="-1"></a>za <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> rep_times))</span>
<span id="cb3-26"><a href="model-building.html#cb3-26" tabindex="-1"></a>zb <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.25</span>, <span class="at">times =</span> rep_times))</span>
<span id="cb3-27"><a href="model-building.html#cb3-27" tabindex="-1"></a>zc <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="at">times =</span> rep_times))</span>
<span id="cb3-28"><a href="model-building.html#cb3-28" tabindex="-1"></a>zd <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> rep_times))</span>
<span id="cb3-29"><a href="model-building.html#cb3-29" tabindex="-1"></a>ze <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">1.5</span>, <span class="at">times =</span> rep_times))</span>
<span id="cb3-30"><a href="model-building.html#cb3-30" tabindex="-1"></a><span class="co"># zf_fun bottom depth, not a layer (this is needed, as zf is is what the D functions use to assess if zi + hi = 0)</span></span>
<span id="cb3-31"><a href="model-building.html#cb3-31" tabindex="-1"></a>zf_fun <span class="ot">=</span> <span class="fl">1.75</span></span>
<span id="cb3-32"><a href="model-building.html#cb3-32" tabindex="-1"></a>zf <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(zf_fun, <span class="at">times =</span> rep_times))</span>
<span id="cb3-33"><a href="model-building.html#cb3-33" tabindex="-1"></a></span>
<span id="cb3-34"><a href="model-building.html#cb3-34" tabindex="-1"></a><span class="co">#calculate h&#39;s, layer thickness</span></span>
<span id="cb3-35"><a href="model-building.html#cb3-35" tabindex="-1"></a>ha <span class="ot">=</span> zb <span class="sc">-</span> za</span>
<span id="cb3-36"><a href="model-building.html#cb3-36" tabindex="-1"></a>hb <span class="ot">=</span> zc <span class="sc">-</span> zb</span>
<span id="cb3-37"><a href="model-building.html#cb3-37" tabindex="-1"></a>hc <span class="ot">=</span> zd <span class="sc">-</span> zc</span>
<span id="cb3-38"><a href="model-building.html#cb3-38" tabindex="-1"></a>hd <span class="ot">=</span> ze <span class="sc">-</span> zd</span>
<span id="cb3-39"><a href="model-building.html#cb3-39" tabindex="-1"></a>he <span class="ot">=</span> zf <span class="sc">-</span> ze</span>
<span id="cb3-40"><a href="model-building.html#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="model-building.html#cb3-41" tabindex="-1"></a><span class="co">#input parameters into data frames</span></span>
<span id="cb3-42"><a href="model-building.html#cb3-42" tabindex="-1"></a>df2[[<span class="st">&quot;z&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(za, zb, zc, zd, ze)</span>
<span id="cb3-43"><a href="model-building.html#cb3-43" tabindex="-1"></a>df2[[<span class="st">&quot;h&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(ha, hb, hc, hd, he)</span>
<span id="cb3-44"><a href="model-building.html#cb3-44" tabindex="-1"></a><span class="co">#below is the starting clay and stone content of each layer, A:E</span></span>
<span id="cb3-45"><a href="model-building.html#cb3-45" tabindex="-1"></a>df2[[<span class="st">&quot;clay&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb3-46"><a href="model-building.html#cb3-46" tabindex="-1"></a>df2[[<span class="st">&quot;stones&quot;</span>]][<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-47"><a href="model-building.html#cb3-47" tabindex="-1"></a></span>
<span id="cb3-48"><a href="model-building.html#cb3-48" tabindex="-1"></a><span class="co">#&#39;###################### [model calculations below] #######################</span></span>
<span id="cb3-49"><a href="model-building.html#cb3-49" tabindex="-1"></a></span>
<span id="cb3-50"><a href="model-building.html#cb3-50" tabindex="-1"></a><span class="co"># define diffusion (bioturbation) function (if statements needed for top and bottom layers) (m/yr)</span></span>
<span id="cb3-51"><a href="model-building.html#cb3-51" tabindex="-1"></a>Dz <span class="ot">&lt;-</span> <span class="cf">function</span>(z) {</span>
<span id="cb3-52"><a href="model-building.html#cb3-52" tabindex="-1"></a>  <span class="cf">if</span>(z <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb3-53"><a href="model-building.html#cb3-53" tabindex="-1"></a>    <span class="dv">0</span> <span class="co"># could an erosion factor be included here ??????</span></span>
<span id="cb3-54"><a href="model-building.html#cb3-54" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-55"><a href="model-building.html#cb3-55" tabindex="-1"></a>    <span class="cf">if</span>(z <span class="sc">==</span> zf_fun) {</span>
<span id="cb3-56"><a href="model-building.html#cb3-56" tabindex="-1"></a>      <span class="dv">0</span> <span class="co"># could a soil production factor be included here ??????</span></span>
<span id="cb3-57"><a href="model-building.html#cb3-57" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-58"><a href="model-building.html#cb3-58" tabindex="-1"></a>      <span class="co">#&#39; [diffusion function defined here]</span></span>
<span id="cb3-59"><a href="model-building.html#cb3-59" tabindex="-1"></a>      <span class="co">#9.81 * 10^-5 * exp(-z/0.28) #linear (Johnson et al., 2014)</span></span>
<span id="cb3-60"><a href="model-building.html#cb3-60" tabindex="-1"></a>      <span class="fl">0.005334</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>z<span class="sc">/</span><span class="fl">0.28</span>) <span class="co">#exponential (Johnson et al., 2014) for eq. (Yeates et a.l, 1995) for intercept</span></span>
<span id="cb3-61"><a href="model-building.html#cb3-61" tabindex="-1"></a>      <span class="co">#6.9 * 10^-5 + -1.06 * 10^-4 * z #exponential (Johnson et al., 2014)</span></span>
<span id="cb3-62"><a href="model-building.html#cb3-62" tabindex="-1"></a>      <span class="co">#0.0426 #earthworms (Yeates et a.l, 1995)</span></span>
<span id="cb3-63"><a href="model-building.html#cb3-63" tabindex="-1"></a>      <span class="co">#0.005334 #earthworms (Darwin 1881)</span></span>
<span id="cb3-64"><a href="model-building.html#cb3-64" tabindex="-1"></a>    }</span>
<span id="cb3-65"><a href="model-building.html#cb3-65" tabindex="-1"></a>  }</span>
<span id="cb3-66"><a href="model-building.html#cb3-66" tabindex="-1"></a>}</span>
<span id="cb3-67"><a href="model-building.html#cb3-67" tabindex="-1"></a></span>
<span id="cb3-68"><a href="model-building.html#cb3-68" tabindex="-1"></a><span class="co"># #diffusion w/ depth function plotting, not needed</span></span>
<span id="cb3-69"><a href="model-building.html#cb3-69" tabindex="-1"></a><span class="co"># eq = function(z){0.005334 * exp(-z)}</span></span>
<span id="cb3-70"><a href="model-building.html#cb3-70" tabindex="-1"></a><span class="co"># ggplot(data.frame(z = c(0, 5)), aes(x = z)) +</span></span>
<span id="cb3-71"><a href="model-building.html#cb3-71" tabindex="-1"></a><span class="co">#   stat_function(fun = eq) +</span></span>
<span id="cb3-72"><a href="model-building.html#cb3-72" tabindex="-1"></a><span class="co">#   scale_y_reverse()</span></span>
<span id="cb3-73"><a href="model-building.html#cb3-73" tabindex="-1"></a></span>
<span id="cb3-74"><a href="model-building.html#cb3-74" tabindex="-1"></a></span>
<span id="cb3-75"><a href="model-building.html#cb3-75" tabindex="-1"></a><span class="co">#&#39; define function that calculates net [clay-diffusion] (g/m/yr) into/out of ith layer</span></span>
<span id="cb3-76"><a href="model-building.html#cb3-76" tabindex="-1"></a>clay_diff_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(Ch, Ci, Cj, zi, hi) {</span>
<span id="cb3-77"><a href="model-building.html#cb3-77" tabindex="-1"></a>  (<span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">*</span> (Ch <span class="sc">-</span> Ci) <span class="sc">+</span></span>
<span id="cb3-78"><a href="model-building.html#cb3-78" tabindex="-1"></a>     (<span class="fu">Dz</span>(<span class="at">z =</span> zi <span class="sc">+</span> hi) <span class="sc">*</span> (Cj <span class="sc">-</span> Ci)) )</span>
<span id="cb3-79"><a href="model-building.html#cb3-79" tabindex="-1"></a>}</span>
<span id="cb3-80"><a href="model-building.html#cb3-80" tabindex="-1"></a></span>
<span id="cb3-81"><a href="model-building.html#cb3-81" tabindex="-1"></a><span class="co">#&#39; define function that calculates net [stones-diffusion] (g/m/yr) into/out of ith layer</span></span>
<span id="cb3-82"><a href="model-building.html#cb3-82" tabindex="-1"></a>stones_diff_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(Sh, Si, Sj, zi, hi) {</span>
<span id="cb3-83"><a href="model-building.html#cb3-83" tabindex="-1"></a>  (<span class="fu">Dz</span>(<span class="at">z =</span> zi) <span class="sc">*</span> Sh <span class="sc">-</span></span>
<span id="cb3-84"><a href="model-building.html#cb3-84" tabindex="-1"></a>     (<span class="fu">Dz</span>(<span class="at">z =</span> zi <span class="sc">+</span> hi) <span class="sc">*</span> Si) )</span>
<span id="cb3-85"><a href="model-building.html#cb3-85" tabindex="-1"></a>}</span>
<span id="cb3-86"><a href="model-building.html#cb3-86" tabindex="-1"></a></span>
<span id="cb3-87"><a href="model-building.html#cb3-87" tabindex="-1"></a></span>
<span id="cb3-88"><a href="model-building.html#cb3-88" tabindex="-1"></a><span class="co"># for loop that fills data frame with diffusion-calculated clay contents</span></span>
<span id="cb3-89"><a href="model-building.html#cb3-89" tabindex="-1"></a><span class="cf">for</span>(crow <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(rep_times)) {</span>
<span id="cb3-90"><a href="model-building.html#cb3-90" tabindex="-1"></a>  <span class="cf">for</span>(ccol <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb3-91"><a href="model-building.html#cb3-91" tabindex="-1"></a>    <span class="co"># apply clay-diffusion function</span></span>
<span id="cb3-92"><a href="model-building.html#cb3-92" tabindex="-1"></a>    df2[[<span class="st">&quot;clay&quot;</span>]][crow, ccol] <span class="ot">=</span> </span>
<span id="cb3-93"><a href="model-building.html#cb3-93" tabindex="-1"></a>      df2[[<span class="st">&quot;clay&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol] <span class="sc">+</span></span>
<span id="cb3-94"><a href="model-building.html#cb3-94" tabindex="-1"></a>      rep_years <span class="sc">*</span> </span>
<span id="cb3-95"><a href="model-building.html#cb3-95" tabindex="-1"></a>      <span class="fu">clay_diff_fun</span>(df2[[<span class="st">&quot;clay&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">-</span> <span class="dv">1</span>],</span>
<span id="cb3-96"><a href="model-building.html#cb3-96" tabindex="-1"></a>                   df2[[<span class="st">&quot;clay&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol],</span>
<span id="cb3-97"><a href="model-building.html#cb3-97" tabindex="-1"></a>                   df2[[<span class="st">&quot;clay&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="cb3-98"><a href="model-building.html#cb3-98" tabindex="-1"></a>                   df2[[<span class="st">&quot;z&quot;</span>]][crow, ccol],</span>
<span id="cb3-99"><a href="model-building.html#cb3-99" tabindex="-1"></a>                   df2[[<span class="st">&quot;h&quot;</span>]][crow, ccol])</span>
<span id="cb3-100"><a href="model-building.html#cb3-100" tabindex="-1"></a>    <span class="co"># apply stones-diffusion function</span></span>
<span id="cb3-101"><a href="model-building.html#cb3-101" tabindex="-1"></a>    df2[[<span class="st">&quot;stones&quot;</span>]][crow, ccol] <span class="ot">=</span> </span>
<span id="cb3-102"><a href="model-building.html#cb3-102" tabindex="-1"></a>      df2[[<span class="st">&quot;stones&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol] <span class="sc">+</span></span>
<span id="cb3-103"><a href="model-building.html#cb3-103" tabindex="-1"></a>      rep_years <span class="sc">*</span> </span>
<span id="cb3-104"><a href="model-building.html#cb3-104" tabindex="-1"></a>      <span class="fu">stones_diff_fun</span>(df2[[<span class="st">&quot;stones&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">-</span> <span class="dv">1</span>],</span>
<span id="cb3-105"><a href="model-building.html#cb3-105" tabindex="-1"></a>                    df2[[<span class="st">&quot;stones&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol],</span>
<span id="cb3-106"><a href="model-building.html#cb3-106" tabindex="-1"></a>                    df2[[<span class="st">&quot;stones&quot;</span>]][crow <span class="sc">-</span> <span class="dv">1</span>, ccol <span class="sc">+</span> <span class="dv">1</span>],</span>
<span id="cb3-107"><a href="model-building.html#cb3-107" tabindex="-1"></a>                    df2[[<span class="st">&quot;z&quot;</span>]][crow, ccol],</span>
<span id="cb3-108"><a href="model-building.html#cb3-108" tabindex="-1"></a>                    df2[[<span class="st">&quot;h&quot;</span>]][crow, ccol])</span>
<span id="cb3-109"><a href="model-building.html#cb3-109" tabindex="-1"></a>  } </span>
<span id="cb3-110"><a href="model-building.html#cb3-110" tabindex="-1"></a>}</span>
<span id="cb3-111"><a href="model-building.html#cb3-111" tabindex="-1"></a></span>
<span id="cb3-112"><a href="model-building.html#cb3-112" tabindex="-1"></a><span class="co">#&#39;###################### [plotting below] #######################</span></span>
<span id="cb3-113"><a href="model-building.html#cb3-113" tabindex="-1"></a></span>
<span id="cb3-114"><a href="model-building.html#cb3-114" tabindex="-1"></a><span class="co">#&#39; [creating a dataframe to plot from]</span></span>
<span id="cb3-115"><a href="model-building.html#cb3-115" tabindex="-1"></a><span class="co"># convert df2 dataframes to long format, one data frame for each clay, stones, and z</span></span>
<span id="cb3-116"><a href="model-building.html#cb3-116" tabindex="-1"></a>df2_clay_long <span class="ot">&lt;-</span> df2[[<span class="st">&quot;clay&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb3-117"><a href="model-building.html#cb3-117" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-118"><a href="model-building.html#cb3-118" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">F =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">5</span><span class="sc">*</span>rep_times)), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb3-119"><a href="model-building.html#cb3-119" tabindex="-1"></a>df2_stones_long <span class="ot">&lt;-</span> df2[[<span class="st">&quot;stones&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb3-120"><a href="model-building.html#cb3-120" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-121"><a href="model-building.html#cb3-121" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">F =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">5</span><span class="sc">*</span>rep_times)), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb3-122"><a href="model-building.html#cb3-122" tabindex="-1"></a><span class="co"># combine long df2 dataframes into one for plotting </span></span>
<span id="cb3-123"><a href="model-building.html#cb3-123" tabindex="-1"></a>df2_z_long <span class="ot">&lt;-</span> df2[[<span class="st">&quot;z&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb3-124"><a href="model-building.html#cb3-124" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;layer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-125"><a href="model-building.html#cb3-125" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">F =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">5</span><span class="sc">*</span>rep_times)), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb3-126"><a href="model-building.html#cb3-126" tabindex="-1"></a></span>
<span id="cb3-127"><a href="model-building.html#cb3-127" tabindex="-1"></a><span class="co"># combine and filter the long df2&#39;s and select for only key time steps</span></span>
<span id="cb3-128"><a href="model-building.html#cb3-128" tabindex="-1"></a>df2_long_join1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df2_clay_long, df2_z_long, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;.clay&quot;</span>, <span class="st">&quot;.z&quot;</span>), <span class="at">by =</span> <span class="st">&quot;F&quot;</span>)</span>
<span id="cb3-129"><a href="model-building.html#cb3-129" tabindex="-1"></a>df2_long_join2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df2_long_join1, df2_stones_long, <span class="at">by =</span> <span class="st">&quot;F&quot;</span>)</span>
<span id="cb3-130"><a href="model-building.html#cb3-130" tabindex="-1"></a></span>
<span id="cb3-131"><a href="model-building.html#cb3-131" tabindex="-1"></a>df2_long <span class="ot">&lt;-</span> df2_long_join2 <span class="sc">%&gt;%</span> </span>
<span id="cb3-132"><a href="model-building.html#cb3-132" tabindex="-1"></a>  <span class="fu">select</span>(time_step.clay, layer.clay, value.clay, value.z, value) <span class="sc">%&gt;%</span> </span>
<span id="cb3-133"><a href="model-building.html#cb3-133" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">time_step =</span> time_step.clay, <span class="at">layer =</span> layer.clay, <span class="at">value.stones =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb3-134"><a href="model-building.html#cb3-134" tabindex="-1"></a>  <span class="fu">filter</span>(time_step <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> </span>
<span id="cb3-135"><a href="model-building.html#cb3-135" tabindex="-1"></a>           time_step <span class="sc">==</span> (rep_times <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">|</span> </span>
<span id="cb3-136"><a href="model-building.html#cb3-136" tabindex="-1"></a>           time_step <span class="sc">==</span> (rep_times <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">|</span> </span>
<span id="cb3-137"><a href="model-building.html#cb3-137" tabindex="-1"></a>           time_step <span class="sc">==</span> (rep_times <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">|</span> </span>
<span id="cb3-138"><a href="model-building.html#cb3-138" tabindex="-1"></a>           time_step <span class="sc">==</span> (rep_times <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">|</span></span>
<span id="cb3-139"><a href="model-building.html#cb3-139" tabindex="-1"></a>           time_step <span class="sc">==</span> (rep_times <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb3-140"><a href="model-building.html#cb3-140" tabindex="-1"></a></span>
<span id="cb3-141"><a href="model-building.html#cb3-141" tabindex="-1"></a><span class="co">#plot stones</span></span>
<span id="cb3-142"><a href="model-building.html#cb3-142" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df2_long, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> value.z,</span>
<span id="cb3-143"><a href="model-building.html#cb3-143" tabindex="-1"></a>                                      <span class="at">x =</span> value.stones, </span>
<span id="cb3-144"><a href="model-building.html#cb3-144" tabindex="-1"></a>                                      <span class="at">group =</span> time_step)) <span class="sc">+</span> </span>
<span id="cb3-145"><a href="model-building.html#cb3-145" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">orientation =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-146"><a href="model-building.html#cb3-146" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">name =</span> <span class="st">&quot;depth (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-147"><a href="model-building.html#cb3-147" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">&quot;stones content (g/m2)&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-148"><a href="model-building.html#cb3-148" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>time_step) <span class="sc">+</span></span>
<span id="cb3-149"><a href="model-building.html#cb3-149" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Stone movement over time&quot;</span></span>
<span id="cb3-150"><a href="model-building.html#cb3-150" tabindex="-1"></a>          , <span class="at">subtitle =</span> <span class="st">&quot;1 timestep = 10 years&quot;</span>)</span></code></pre></div>
<p><img src="05_bioturbation_model_files/figure-html/diffusion-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="model-building.html#cb4-1" tabindex="-1"></a><span class="co">#plot clay</span></span>
<span id="cb4-2"><a href="model-building.html#cb4-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df2_long, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> value.z,</span>
<span id="cb4-3"><a href="model-building.html#cb4-3" tabindex="-1"></a>                                      <span class="at">x =</span> value.clay, </span>
<span id="cb4-4"><a href="model-building.html#cb4-4" tabindex="-1"></a>                                      <span class="at">group =</span> time_step)) <span class="sc">+</span> </span>
<span id="cb4-5"><a href="model-building.html#cb4-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">orientation =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-6"><a href="model-building.html#cb4-6" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">name =</span> <span class="st">&quot;depth (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="model-building.html#cb4-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">&quot;clay content (g/m2)&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="model-building.html#cb4-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>time_step) <span class="sc">+</span></span>
<span id="cb4-9"><a href="model-building.html#cb4-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Clay movement over time&quot;</span></span>
<span id="cb4-10"><a href="model-building.html#cb4-10" tabindex="-1"></a>          , <span class="at">subtitle =</span> <span class="st">&quot;1 timestep = 10 years&quot;</span>)</span></code></pre></div>
<p><img src="05_bioturbation_model_files/figure-html/diffusion-2.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="model-building.html#cb5-1" tabindex="-1"></a><span class="co">#&#39; [basic plot, clay content over time for each layer]</span></span>
<span id="cb5-2"><a href="model-building.html#cb5-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df2[[<span class="st">&quot;stones&quot;</span>]]) <span class="sc">+</span></span>
<span id="cb5-3"><a href="model-building.html#cb5-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> A, <span class="at">x =</span> time_step, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="model-building.html#cb5-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> B, <span class="at">x =</span> time_step, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb5-5"><a href="model-building.html#cb5-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> C, <span class="at">x =</span> time_step, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb5-6"><a href="model-building.html#cb5-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> D, <span class="at">x =</span> time_step, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="model-building.html#cb5-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> E, <span class="at">x =</span> time_step, <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>))</span></code></pre></div>
<p><img src="05_bioturbation_model_files/figure-html/diffusion-3.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="model-building.html#cb6-1" tabindex="-1"></a><span class="co">#&#39;[run above]</span></span></code></pre></div>
</div>
<div id="erosion-and-soil-formation" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Erosion and Soil Formation<a href="model-building.html#erosion-and-soil-formation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>WIP</p>
<p>At the top and bottom of the profile, the above diffusion equations are adjusted to be zero. At the top, and erosion factor. Bulk density is assumed to be consistent throughout the profile.</p>
</div>
</div>
<div id="references-2" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> References<a href="model-building.html#references-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="animals-as-agents-of-heterogeneity-and-homogeneity-in-soil-and-landscape-development-a-review.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
